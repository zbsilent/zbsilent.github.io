(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{442:function(t,e,a){"use strict";a.r(e);var l=a(54),i=Object(l.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("ol",[a("li",[a("p",[t._v("更新并安装依赖")]),t._v(" "),a("blockquote",[a("p",[t._v("sudo yum -y -update")]),t._v(" "),a("p",[t._v("sudo  yum -y install policycoreutils openssh-server openssh-clients postfix policycoreutils-python ca-certificates curl")])])]),t._v(" "),a("li",[a("p",[t._v("安装路径")]),t._v(" "),a("blockquote",[a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/zbsilent/imag/main/img/2022/image-20231212195128572.png",alt:"image-20231212195128572"}})])])]),t._v(" "),a("li",[a("p",[t._v("备份")]),t._v(" "),a("blockquote",[a("p",[t._v("sudo gitlab-backup create")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/zbsilent/imag/main/img/2022/image-20231212215756594.png",alt:"image-20231212215756594"}})])])]),t._v(" "),a("li",[a("p",[t._v("下载目录及安装版本")]),t._v(" "),a("blockquote",[a("p",[t._v("/etc/gitlab/gitlabsoft")])])]),t._v(" "),a("li",[a("p",[t._v("版本")]),t._v(" "),a("blockquote",[a("p",[t._v("sudo wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-16.6.1-ce.0.el7.x86_64.rpm")]),t._v(" "),a("p",[t._v("rpm -ivh gitlab-ce-14.10.5-ce.0.el7.x86_64.rpm")])])]),t._v(" "),a("li",[a("p",[t._v("配置地址")]),t._v(" "),a("blockquote",[a("p",[t._v("vi /etc/gitlab/gitlab.rb\nexternal_url 'http://192.168.109.128:9090' # ===>这里一定要加上http://")])])]),t._v(" "),a("li",[a("p",[t._v("在 "),a("code",[t._v("/etc/gitlab/gitlab.rb")]),t._v(" 文件中，有许多用于各种类型日志的 "),a("code",[t._v("log_directory")]),t._v(" 键。取消注释并更新要放置在其他地方的所有日志的值：")]),t._v(" "),a("blockquote",[a("h1",{attrs:{id:"for-example"}},[t._v("For example:")]),t._v(" "),a("p",[t._v("gitlab_rails['log_directory'] = \"/var/log/gitlab/gitlab-rails\"\npuma['log_directory'] = \"/var/log/gitlab/puma\"\nregistry['log_directory'] = \"/var/log/gitlab/registry\"")])])]),t._v(" "),a("li",[a("p",[t._v("邮箱配置")]),t._v(" "),a("blockquote",[a("p",[t._v("vi /etc/gitlab/gitlab.rb")]),t._v(" "),a("p",[t._v("gitlab-rails console")]),t._v(" "),a("p",[t._v("Notify.test_email('收件人邮箱', '邮件标题', '邮件正文').deliver_now")]),t._v(" "),a("p",[t._v("Notify.test_email('mail地址', '邮件标题', '邮件正文').deliver_now")]),t._v(" "),a("p",[t._v('{:authentication=>:login,\n:user_name=>"******@163.com",\n:password=>"WZZFIXUOLHOJHFWN",\n:address=>"smtp.163.com",\n:port=>25,\n:domain=>"163.com",\n:enable_starttls_auto=>true,\n:tls=>false,\n:ca_file=>"/opt/gitlab/embedded/ssl/certs/cacert.pem",\n:open_timeout=>30,\n:read_timeout=>60}')])])]),t._v(" "),a("li",[a("p",[t._v("安装命令开放端口")]),t._v(" "),a("blockquote",[a("p",[t._v("sudo systemctl enable sshd\nsudo systemctl start sshd\nsudo firewall-cmd --permanent --add-service=http\nsudo systemctl reload firewalld")]),t._v(" "),a("p",[t._v("sudo systemctl enable postfix\nsudo systemctl start postfix")]),t._v(" "),a("p",[t._v("firewall-cmd --add-port=9081/tcp --permanent")]),t._v(" "),a("p",[t._v("firewall-cmd --add-port=25/tcp --permanent")]),t._v(" "),a("p",[t._v("systemctl restart firewalld.service")])])]),t._v(" "),a("li",[a("p",[t._v("进入查看gitlab.yml")]),t._v(" "),a("blockquote",[a("p",[t._v("cd /opt/gitlab/embedded/service/gitlab-rails/config")]),t._v(" "),a("p",[t._v("vi gitlab.yml  这里需要设置下载地址")])])]),t._v(" "),a("li",[a("p",[t._v("重启")]),t._v(" "),a("blockquote",[a("p",[t._v("gitlab-ctl reconfigure\ngitlab-ctl restart")])])]),t._v(" "),a("li",[a("p",[t._v("常用命令")]),t._v(" "),a("blockquote",[a("h1",{attrs:{id:"开启-关闭-重启-gitlab组件"}},[t._v("开启,关闭,重启: gitlab组件")]),t._v(" "),a("p",[t._v("gitlab-ctl {start|stop|restart|status} \t\t\ngitlab-ctl start\ngitlab-ctl stop\ngitlab-ctl restart\ngitlab-ctl status")]),t._v(" "),a("h1",{attrs:{id:"重载配置文件-重新编译gitlab的配置"}},[t._v("重载配置文件(重新编译gitlab的配置)")]),t._v(" "),a("p",[t._v("gitlab-ctl reconfigure")]),t._v(" "),a("h1",{attrs:{id:"验证配置文件"}},[t._v("验证配置文件")]),t._v(" "),a("p",[t._v("gitlab-ctl show-config")]),t._v(" "),a("h1",{attrs:{id:"检查gitlab"}},[t._v("检查gitlab")]),t._v(" "),a("p",[t._v("gitlab-rake gitlab:check SANITIZE=true --trace")]),t._v(" "),a("h1",{attrs:{id:"查看日志"}},[t._v("查看日志")]),t._v(" "),a("p",[t._v("gitlab-ctl tail\ngitlab-ctl tail nginx/gitlab_access.log\ngitlab-ctl tail nginx/gitlab_error.log")]),t._v(" "),a("h1",{attrs:{id:"常用目录"}},[t._v("常用目录")]),t._v(" "),a("p",[t._v("日志地址：/var/log/gitlab/   # 对应各服务的打印日志\n服务地址：/var/opt/gitlab/   # 对应各服务的主目录")])])]),t._v(" "),a("li",[a("p",[t._v("两部验证")]),t._v(" "),a("blockquote",[a("p",[t._v("https://zhuanlan.zhihu.com/p/649375110")]),t._v(" "),a("p",[t._v("GitLab的双因子认证（2FA）可以提供额外的账户安全保护。以下是启用和使用GitLab双因子认证的基本步骤：")]),t._v(" "),a("p",[t._v("一、管理员强制启用双因子认证")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/zbsilent/imag/main/img/2022/v2-45baf4108dd7bbc9098e2b30ce064b72_1440w-20231212221138369.webp",alt:"img"}})]),t._v(" "),a("p",[t._v("二、用户首次登录配置双因子")]),t._v(" "),a("p",[t._v("1、登录gitlab后会自动跳转到两步验证配置页面")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/zbsilent/imag/main/img/2022/v2-64b0086d31fca479054744d832d02a4c_1440w-20231212221132753.webp",alt:"img"}})]),t._v(" "),a("p",[t._v("2、手机下载Google Authenticator apk或者使用微信小程序")]),t._v(" "),a("p",[t._v("微信小程序搜索Authly，直接使用小程序也可以实现")]),t._v(" "),a("p",[t._v("apk下载链接: "),a("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//pan.baidu.com/s/1SszwZ8hmaz-I-74cfQmLdw",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pan.baidu.com/s/1SszwZ8hmaz-I-74cfQmLdw"),a("OutboundLink")],1),t._v(" 密码: fuee")]),t._v(" "),a("p",[t._v("3、打开Google Authenticator 点击右下角扫描二维码，扫描后会获取到一个pin码")]),t._v(" "),a("p",[t._v("4、直接将pin码填入gitlab配置页面即可")]),t._v(" "),a("p",[t._v("三、完成配置后再次打开gitlab会调整到如下页面，直接填写对应pin码即可登录。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/zbsilent/imag/main/img/2022/v2-6d168f9eda736d158c8a1af4ca9375ce_1440w-20231212221128353.webp",alt:"img"}})])])]),t._v(" "),a("li",[a("p",[t._v("linux命令补全")]),t._v(" "),a("blockquote",[a("p",[t._v("1.查看防火墙某个端口是否开放：firewall-cmd --query-port=80/tcp")]),t._v(" "),a("p",[t._v("2.开放80端口（重启防火墙生效）：firewall-cmd --add-port=80/tcp --permanent")]),t._v(" "),a("p",[t._v("3.关闭防火墙端口80：firewall-cmd --remove-port=80/tcp --permanent")]),t._v(" "),a("p",[t._v("4.重启防火墙：systemctl restart firewalld.service")]),t._v(" "),a("p",[t._v("5.开放一段端口：firewall-cmd --zone=public --add-port=40000-45000/tcp --permanent")]),t._v(" "),a("p",[t._v("6.查看开放的端口列表：firewall-cmd --zone=public --list-ports")]),t._v(" "),a("p",[t._v("7.查看被监听（Listen）的端口：netstat -lntp")]),t._v(" "),a("p",[t._v("sudo xattr -d com.apple.quarantine /Applications/PicGo.app")])])])])])}),[],!1,null,null,null);e.default=i.exports}}]);